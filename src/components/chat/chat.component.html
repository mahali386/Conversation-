<div class="flex flex-col h-full bg-white dark:bg-slate-800 rounded-lg shadow-xl overflow-hidden">
  
  <header class="p-4 border-b border-slate-200 dark:border-slate-700 flex items-center space-x-4 bg-slate-50 dark:bg-slate-900/50 flex-shrink-0">
    <div class="relative flex items-center justify-center w-12 h-12 rounded-full bg-emerald-500 text-white text-2xl font-bold">
      A
      @if (isProcessing()) {
        <div class="absolute inset-0 rounded-full border-2 border-emerald-300 animate-ping"></div>
      }
    </div>
    <div>
      <h1 class="text-xl font-bold text-slate-800 dark:text-white">Alex</h1>
      <p class="text-sm text-slate-500 dark:text-slate-400">Your English Pal</p>
    </div>
  </header>

  <div #chatContainer class="flex-1 p-6 overflow-y-auto space-y-6 scroll-smooth">
    @for (message of messages(); track $index) {
      <div class="flex" [class.justify-end]="message.sender === 'user'" [class.justify-start]="message.sender === 'ai'">
        @if (message.sender === 'ai') {
          <div class="flex items-start gap-3">
            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-emerald-500 flex items-center justify-center text-white font-bold text-sm">A</div>
            <div class="max-w-md bg-slate-100 dark:bg-slate-700 text-slate-800 dark:text-slate-200 rounded-xl p-3 rounded-tl-none">
              <p [innerHTML]="formatMessage(message.text)"></p>
              @if (message.isStreaming) {
                <span class="inline-block w-2 h-2 ml-1 bg-slate-500 rounded-full animate-pulse"></span>
              }
            </div>
          </div>
        } @else {
           <div class="flex items-start gap-3 justify-end">
            <div class="max-w-md bg-blue-500 text-white rounded-xl p-3 rounded-br-none">
              <p>{{ message.text }}</p>
            </div>
            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold text-sm">U</div>
          </div>
        }
      </div>
    }
  </div>

  <footer class="p-4 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 flex-shrink-0">
    @if (error()) {
      <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded-md" role="alert">
        <p class="font-bold">Error</p>
        <p>{{ error() }}</p>
      </div>
    }
    
    <div class="flex flex-col items-center justify-center">
      <button (click)="toggleListening()"
              [disabled]="isProcessing()"
              class="relative w-20 h-20 rounded-full transition-all duration-300 ease-in-out focus:outline-none focus:ring-4 focus:ring-offset-2 dark:focus:ring-offset-slate-800 disabled:opacity-50 disabled:cursor-not-allowed"
              [class.bg-red-500]="isListening()" [class.hover:bg-red-600]="isListening()" [class.focus:ring-red-300]="isListening()"
              [class.bg-blue-500]="!isListening()" [class.hover:bg-blue-600]="!isListening()" [class.focus:ring-blue-300]="!isListening()"
              [class.scale-110]="isListening()"
              [class.animate-pulse]="isProcessing()">
        <svg class="w-10 h-10 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 016 0v8.25a3 3 0 01-3 3z" />
        </svg>
      </button>
      <p class="mt-3 text-sm text-slate-500 dark:text-slate-400 h-6">
        @if (isListening()) {
          <span class="text-red-500 dark:text-red-400">Listening...</span>
        } @else if (isProcessing()) {
          <span class="text-slate-500">Thinking...</span>
        } @else {
          <span>Tap to speak</span>
        }
      </p>
    </div>
  </footer>
</div>